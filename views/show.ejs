<!DOCTYPE html>
<html>
<head>
  <title>roomy</title>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/8e82e704c0.js" crossorigin="anonymous"></script>
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  <link rel="stylesheet" type="text/css" href="/css/roomy4.css">
  <link rel="stylesheet" type="text/css" href="/css/showpage.css">

<script src="/js/jquery.min.js"></script>
<script src="/js/slick.min.js"></script> 
</head>
<body>


<nav class="navbar fixed-top navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand inverted" href="/">Roomy</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="fa fa-ellipsis-v" ></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
        <!-- <li class="nav-item">
          <a class="nav-link active" href="/">Home <span class="sr-only">(current)</span></a>
        </li> -->
        <li class="nav-item dropdown">
          <a class="nav-link" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Services</a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="/property">Rental</a>
            <a class="dropdown-item" href="/user">Searching</a>
            <a class="dropdown-item" href="/user">Broker</a>
          </div>
        </li>
        <% if(!currentUser){ %>
          <li class="nav-item">
            <a class="nav-link" href="/user">Login <span class="sr-only">(current)</span></a>
          </li>
        <% } else { %>
          <li class="nav-item">
            <a class="nav-link" href="/users/<%= currentUser._id %>" style="color:rgb(100,150,255);">
              <strong><i class="fas fa-user"></i> <%=currentUser.username%></strong>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/logout">Log out</a>
          </li>
        <% } %>
        <!-- <li class="nav-item">
          <a class="nav-link" id="darkmode" onclick="changeMode()" style="font-size: 1.3em; padding:0px 10px;margin-top: 8px;"><i class="fa fa-adjust"></i></a>
        </li> -->
      </ul>
    </div>
  </div>
</nav>

<div class="container showcon">

<div class="container">
    <% if(error && error.length > 0){ %>
        <div class="alert alert-danger" role="alert">
            <button type="button" data-dismiss="alert" aria-label="Close" class="close" style="outline:none;">
              <span aria-hidden="true">&times;</span>
            </button>
            <%= error %>
        </div>
    <% } %>
    <% if(success && success.length > 0){ %>
        <div class="alert alert-success" role="alert">
            <button type="button" data-dismiss="alert" aria-label="Close" class="close" style="outline:none;">
              <span aria-hidden="true">&times;</span>
            </button>
            <%= success %>
        </div>
    <% } %>
</div>
  
  <div class="row">
    <div class="col-md-3 showincon1">
      <p class="lead"><b>Roomy</b></p>
      <div class="list-group">
        <strong>
          <div class="list-group-item"><i class="fa fa-user"></i> <%= roomy.name %></div>
          <div class="list-group-item"><i class="fa fa-phone"></i> +91 - <%= roomy.number %></div>
          <div class="list-group-item"><i class="fa fa-map-marker"></i> <%= roomy.location %></div>
          <div class="list-group-item"><i class="fa fa-rupee"></i> <%= roomy.amount %>/-</div>
          <div class="list-group-item">
            Booking window
            <li>
              <%= roomy.booking.start %> -
              <%= roomy.booking.end %>          
            </li>
          </div><br>
          <div class="list-group-item inmap">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3665.8789125782564!2d77.49986176474188!3d23.24749298483965!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x397c41e4394f4f87%3A0xb3bba34206ce5dec!2sOriental%20Institute%20of%20Science%20%26%20Technology%20-%20Best%20Engineering%20College%20In%20Bhopal!5e0!3m2!1sen!2sin!4v1593244474096!5m2!1sen!2sin" width="100%" height="350vh" frameborder="0" allowfullscreen="" aria-hidden="false" tabindex="0" class="inverted"></iframe>
          </div>
        </strong>
      </div>
    </div>
    <div class="col-md-9" style="margin-bottom: 10%;">
      <div class="thumbnail incon1">
        <img class="img-responsive inverted" src="<%= roomy.image %>">
        <div class="caption-full">
          <h4 class="inh4"><i class="fa fa-rupee"></i> <%= roomy.amount %></h4>
          <h4><a><%= roomy.type %></a></h4>
          <h6 style="display: inline;">
            <%= roomy.select1 %> <%= roomy.select2 %> <%= roomy.select3 %> <%= roomy.select4 %>
            <%= roomy.select5 %> <%= roomy.select6 %> <%= roomy.select7 %> <%= roomy.select8 %>
            <%= roomy.select9 %> <%= roomy.select10 %> <%= roomy.select11 %>
          </h6>
          <div class="inem">
            <% if(roomy.comments.length === 0) { %>
              <span class="text-muted">No Reviews</span>
            <% } else { %>
              <!-- Ratings - <b><%= roomy.rateAvg %></b> | --> 
              <% var stars = ['<i class="fa fa-star text-danger "></i>', '<i class="fa fa-star text-danger "></i>', '<i class="fa fa-star text-danger "></i>', '<i class="fa fa-star text-danger "></i>', '<i class="fa fa-star text-danger "></i>'] %>
              <% for(var i = 0; i < Math.round(roomy.rateAvg); i++) { %>
                <i class="fa fa-star text-danger"></i>
              <% } %>
              <% if (roomy.comments.length === 1) { %>
                <span class="text-muted"><%= roomy.comments.length %> Review</span>
              <% } else { %>
                <span class="text-muted"><%= roomy.comments.length %> Reviews</span>
              <% } %>
            <% } %>
          </div>
          <hr>
          <div class="row inrow">
            <div class="col-lg-4 col-4 incon11">
              <em>
                <!-- <%= roomy.author.username %>, <%= moment(roomy.createdAt).fromNow() %> -->
                <%= roomy.name %>, <%= moment(roomy.createdAt).fromNow() %>
              </em>
            </div>
            <div class="col-lg-8 col-8 incon12">
              <% if(currentUser && roomy.author.id.equals(currentUser._id)){ %>
                <a class="btn btnedit inverted" href="/roomy/<%= roomy._id %>/edit"><span>Edit</span> <i class="fa fa-edit"></i></a>
                <form class="delete-form" action="/roomy/<%= roomy._id %>?_method=DELETE" method="POST">
                  <button class="btn btnedit inverted"><span>Delete</span> <i class="fa fa-trash"></i></button>
                </form>
              <% } %>
              <a class="btn btnback inverted" href="/roomy">Go Back!</a>
              <!-- <i class="fa fa-heart"></i> -->
            </div>
          </div>
        </div>
      </div>

      <div class="well">

        <form class="inform1" action="/roomy/<%= roomy._id %>/comments" method="POST">
          <div class="row">
            <input id="inputform" class="form-control col-md-10 col-12" type="text" name="comment[text]" placeholder="Comment here...">
            <button class="btn col-md-1 col-6 inverted" data-toggle="collapse" data-target="#collapseComment" style="border-radius: 0rem;border-right: 1px solid;" type="button">Rate</button>
            <button class="btn col-md-1 col-6 inverted" type="submit">Post</button>
            <div class="form-group collapse" id="collapseComment" style="margin:0% auto;padding:1%;">
              <label for="" class="mr-2">Rating: </label>
              <div class="custom-control custom-radio custom-control-inline">
                <input type="radio" id="customRadio1" name="comment[rating]" value="1" class="custom-control-input">
                <label class="custom-control-label" for="customRadio1">1</label>
              </div>
              <div class="custom-control custom-radio custom-control-inline">
                <input type="radio" id="customRadio2" name="comment[rating]" value="2" class="custom-control-input">
                <label class="custom-control-label" for="customRadio2">2</label>
              </div>
              <div class="custom-control custom-radio custom-control-inline">
                <input type="radio" id="customRadio3" name="comment[rating]" value="3" class="custom-control-input">
                <label class="custom-control-label" for="customRadio3">3</label>
              </div>
              <div class="custom-control custom-radio custom-control-inline">
                <input type="radio" id="customRadio4" name="comment[rating]" value="4" class="custom-control-input">
                <label class="custom-control-label" for="customRadio4">4</label>
              </div>
              <div class="custom-control custom-radio custom-control-inline">
                <input type="radio" id="customRadio5" name="comment[rating]" value="5" class="custom-control-input">
                <label class="custom-control-label" for="customRadio5">5</label>
              </div>
              <div class="invalid-feedback">
                Please provide a rating.
              </div>
            </div>
          </div>
        </form>

        <div class="row inform2">
        <% roomy.comments.forEach(function(comment){ %>
          <div class="col-md-12">
            <strong><%= comment.author.username %> </strong>
                  <span class="text-muted">
                    <% var stars2 = ['<small><i class="fa fa-star text-danger"></i></small>', '<small><i class="fa fa-star text-danger"></i></small>', '<small><i class="fa fa-star text-danger"></i></small>', '<small><i class="fa fa-star text-danger"></i></small>', '<small><i class="fa fa-star text-danger"></i></small>'] %>
                     |
                    <% for(var i = 0; i < comment.rating; i++) { %>
                        <small><i class="fa fa-star text-danger"></i></small>
                    <% } %>
                  </span>
            <span class="incomment">
              <%= moment(comment.createdAt).fromNow() %> <br>
              <% if(currentUser && comment.author.id.equals(currentUser._id)){ %>
                <form class="delete-form" action="/roomy/<%=roomy._id%>/comments/<%=comment._id%>?_method=DELETE" method="POST">
                  <button type="submit" class="close" value="Delete" style="outline:none;">
                    <span>&times;</span>
                  </button>
                </form>
              <% } %>
            </span>
            <p>
              <%= comment.text %>
            </p>
          </div>
        <% }); %>
        </div>
      </div>
      <em style="font-size: 10px;">All Rights Reserved, Curated By @ Mayank Singh Thakur</em>
    </div>
  </div>
</div> 

<nav class="navbar fixed-bottom navbar-expand-lg">
  <a class="navbar-brand">
    <i  class="fa fa-comments"
        style="font-size: 2em;" 
        data-container="body" 
        data-toggle="popover" 
        data-placement="top"
        ></i> <span><strong>Chat</strong>here</span>
  </a>
</nav>

<section>
  <div id="PopoverContent" class="d-none">
    <% if(currentUser){ %>
    <div class="input-group">
        <div class="chatwindow">
          <% roomy.messages.forEach(function(message){ %>
            <% if(currentUser && message.author.id.equals(currentUser._id)){ %>
              <em class="message" style="float: right;"><%= message.text %></em><br>
              <!-- <form action="/new/<%=roomy._id%>/messages/<%=message._id%>?_method=DELETE" method="POST">
                <button type="submit" class="close" value="Delete">
                  <span>&times;</span>
                </button>
              </form> -->
            <% } else {%>
              <h6 style="display: inline;font-size: 15px;"><%= message.author.username %> - </h6>
              <em class="message" style="display: inline;"><%= message.text %></em><br>
            <% } %>
          <% }); %>
        </div>
    </div>
    <form action="/roomy/<%= roomy._id %>/messages" method="POST">
      <div class="input-group">
        <input type="text" name="message[text]" placeholder=" Type new...">
        <button class="btn">
          <i class="fa fa-send"></i>
        </button>
      </div>
    </form>
    <% } else { %>
    <div class="input-group">
      <div class="chatwindow">
        <em class="message" style="float:right;">you need to be logged in!</em><br>
      </div>
    </div>
    <form>
      <div class="input-group">
        <input type="text" placeholder="Type new...">
        <button class="btn">
          <i class="fa fa-send"></i>
        </button>
      </div>
    </form>
    <% } %>
  </div>
</section>

<script>
$(function () {
  $('[data-toggle="popover"]').popover({
      container: 'body',
      title: 'Talk to <%= roomy.name %>',
      html: true,
      placement: 'bottom',
      sanitize: false,
      content: function () {
          return $("#PopoverContent").html();
      }
  });
})

$(document).on('click', '#PopoverContent', function (e) {
  e.stopPropagation();
});

</script>

<%- include ('./partials/footer'); -%>